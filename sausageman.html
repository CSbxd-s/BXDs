<html lang="id">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Topup Sausage Man - BOI XD Topup
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap" rel="stylesheet"/>
  <style>
   body {
    font-family: "Inter", sans-serif;
  }
  input[type="radio"] {
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    width: 100%;
    height: 100%;
    margin: 0;
    cursor: pointer;
    border-radius: 0.5rem;
    border: 2px solid #d1d5db;
    transition: border-color 0.3s, background-color 0.3s;
    position: relative;
    outline-offset: 2px;
  }
  input[type="radio"]:checked {
    border-color: #6366f1;
    background-color: #e0e7ff;
  }
  input[type="radio"]:focus-visible {
    outline: 2px solid #6366f1;
    outline-offset: 2px;
  }
  label.radio-label {
    cursor: pointer;
    user-select: none;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 0.75rem 1rem;
    border-radius: 0.5rem;
    border: 2px solid transparent;
    transition: border-color 0.3s;
    height: 80px;
    font-size: 1rem;
    text-align: center;
  }
  input[type="radio"]:checked + label.radio-label {
    border-color: #6366f1;
    background-color: #e0e7ff;
  }
  .payment-logo-rect {
    width: 48px;
    height: 24px;
    object-fit: contain;
    border-radius: 0.25rem;
  }
  .payment-logo-square {
    width: 32px;
    height: 32px;
    object-fit: contain;
    border-radius: 0.25rem;
  }
  .payment-disabled {
    opacity: 0.5;
    pointer-events: none;
  }
  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
  .fade-in {
    animation: fadeIn 0.8s ease forwards;
  }
  .btn-press {
    animation: btnPressAnim 0.2s ease forwards;
  }
  @keyframes btnPressAnim {
    0% {
      transform: scale(1);
      opacity: 1;
    }
    50% {
      transform: scale(0.95);
      opacity: 0.7;
    }
    100% {
      transform: scale(1);
      opacity: 1;
    }
  }
  /* Custom styles for pack section */
  #packSection fieldset {
    border: 2px solid #d1d5db;
    border-radius: 0.5rem;
    padding: 1rem;
    max-height: 400px;
    overflow-y: auto;
  }
  </style>
 </head>
 <body class="bg-gray-50 min-h-screen flex flex-col">
  <header class="bg-white shadow-md sticky top-0 z-30 fade-in">
   <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center">
    <a aria-label="Kembali ke beranda" class="text-indigo-600 hover:text-indigo-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded mr-4 flex items-center" href="topup.html">
     <i class="fas fa-arrow-left">
     </i>
    </a>
    <h1 class="text-2xl font-semibold text-gray-800">
     Topup Sausage Man
    </h1>
   </div>
  </header>
  <main class="flex-grow max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8 fade-in">
   <section class="bg-white rounded-lg shadow p-6">
    <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-6 mb-6 fade-in">
     <img alt="Logo game Sausage Man dengan latar belakang berwarna cerah dan karakter utama, resolusi 128x128" class="w-32 h-32 object-contain mx-auto sm:mx-0 rounded" height="128" loading="lazy" src="https://i.ibb.co/JW8KkpP5/sausageman.jpg" width="128"/>
     <div class="mt-4 sm:mt-0 text-center sm:text-left">
      <h2 class="text-xl font-semibold text-gray-900">
       Sausage Man
      </h2>
      <p class="mt-2 text-gray-600">
       Top up koin Sausage Man Anda dengan cepat dan aman. Pilih nominal yang diinginkan dan selesaikan pembelian Anda.
      </p>
     </div>
    </div>
    <form class="space-y-6 fade-in" id="topupForm" novalidate="">
     <div>
      <label class="block text-sm font-medium text-gray-700 mb-2" for="userId">
       ID Pengguna
      </label>
      <input aria-describedby="userIdHelp" autocomplete="off" class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-gray-700" id="userId" name="userId" placeholder="Masukkan ID Pengguna" type="text"/>
      <p class="mt-1 text-xs text-gray-500" id="userIdHelp">
       ID unik pemain Sausage Man Anda.
      </p>
     </div>
     <div>
      <span class="block text-sm font-medium text-gray-700 mb-2">
       Jenis Topup
      </span>
      <div class="border border-gray-300 rounded-md p-4 relative">
       <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
         <span class="font-semibold text-gray-900" id="selectedTopupType">
          Pilih Jenis Topup
         </span>
        </div>
        <button aria-controls="topupTypeOptions" aria-expanded="false" class="text-indigo-600 hover:text-indigo-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded flex items-center space-x-1" id="toggleTopupTypeBtn" type="button">
         <span id="toggleTopupTypeText">
          Detail
         </span>
         <i class="fas fa-chevron-down" id="toggleTopupTypeIcon">
         </i>
        </button>
       </div>
       <div aria-label="Opsi jenis topup" class="mt-4 border-t border-gray-200 pt-4 grid grid-cols-2 gap-4 hidden" id="topupTypeOptions" role="list">
        <div class="col-span-2" role="listitem">
         <input class="hidden peer" id="topupCandy" name="topupType" type="radio" value="candy"/>
         <label class="radio-label peer-checked:border-indigo-500 peer-checked:bg-indigo-100 cursor-pointer" for="topupCandy" tabindex="0">
          <span class="text-lg font-semibold text-gray-900">
           Candy
          </span>
         </label>
        </div>
        <div class="col-span-2" role="listitem">
         <input class="hidden peer" id="topupPass" name="topupType" type="radio" value="pass"/>
         <label class="radio-label peer-checked:border-indigo-500 peer-checked:bg-indigo-100 cursor-pointer" for="topupPass" tabindex="0">
          <span class="text-lg font-semibold text-gray-900">
           Pass
          </span>
         </label>
        </div>
       </div>
      </div>
      <p class="mt-1 text-sm text-red-600 hidden" id="topupTypeError" role="alert">
       Harap pilih jenis topup.
      </p>
     </div>
     <div class="hidden" id="candySection">
      <div class="flex justify-between items-center mb-2">
       <span class="block text-sm font-medium text-gray-700">
        Candy
       </span>
       <button aria-expanded="true" class="text-indigo-600 hover:text-indigo-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded text-sm" id="toggleCandyDetailsBtn" type="button">
        Sembunyikan
       </button>
      </div>
      <fieldset aria-describedby="packageErrorCandy" aria-required="true" class="grid grid-cols-2 sm:grid-cols-3 gap-4 max-h-96 overflow-y-auto">
       <div>
        <input class="hidden peer" id="candy61" name="package" type="radio" value="61"/>
        <label class="radio-label peer-checked:border-indigo-500 peer-checked:bg-indigo-100 flex flex-col items-center justify-center" for="candy61" tabindex="0">
         <span class="text-lg font-semibold text-gray-900">
          61 Candies
         </span>
         <span class="text-sm text-gray-600">
          Rp 11.976
         </span>
        </label>
       </div>
       <div>
        <input class="hidden peer" id="candy186" name="package" type="radio" value="186"/>
        <label class="radio-label peer-checked:border-indigo-500 peer-checked:bg-indigo-100 flex flex-col items-center justify-center" for="candy186" tabindex="0">
         <span class="text-lg font-semibold text-gray-900">
          186 Candies
         </span>
         <span class="text-sm text-gray-600">
          Rp 36.727
         </span>
        </label>
       </div>
       <div>
        <input class="hidden peer" id="candy318" name="package" type="radio" value="318"/>
        <label class="radio-label peer-checked:border-indigo-500 peer-checked:bg-indigo-100 flex flex-col items-center justify-center" for="candy318" tabindex="0">
         <span class="text-lg font-semibold text-gray-900">
          318 Candies
         </span>
         <span class="text-sm text-gray-600">
          Rp 61.729
         </span>
        </label>
       </div>
       <div>
        <input class="hidden peer" id="candy686" name="package" type="radio" value="686"/>
        <label class="radio-label peer-checked:border-indigo-500 peer-checked:bg-indigo-100 flex flex-col items-center justify-center" for="candy686" tabindex="0">
         <span class="text-lg font-semibold text-gray-900">
          686 Candies
         </span>
         <span class="text-sm text-gray-600">
          Rp 122.857
         </span>
        </label>
       </div>
       <div>
        <input class="hidden peer" id="candy1378" name="package" type="radio" value="1378"/>
        <label class="radio-label peer-checked:border-indigo-500 peer-checked:bg-indigo-100 flex flex-col items-center justify-center" for="candy1378" tabindex="0">
         <span class="text-lg font-semibold text-gray-900">
          1378 Candies
         </span>
         <span class="text-sm text-gray-600">
          Rp 246.014
         </span>
        </label>
       </div>
       <div>
        <input class="hidden peer" id="candy2118" name="package" type="radio" value="2118"/>
        <label class="radio-label peer-checked:border-indigo-500 peer-checked:bg-indigo-100 flex flex-col items-center justify-center" for="candy2118" tabindex="0">
         <span class="text-lg font-semibold text-gray-900">
          2118 Candies
         </span>
         <span class="text-sm text-gray-600">
          Rp 366.875
         </span>
        </label>
       </div>
       <div>
        <input class="hidden peer" id="candy3548" name="package" type="radio" value="3548"/>
        <label class="radio-label peer-checked:border-indigo-500 peer-checked:bg-indigo-100 flex flex-col items-center justify-center" for="candy3548" tabindex="0">
         <span class="text-lg font-semibold text-gray-900">
          3548 Candies
         </span>
         <span class="text-sm text-gray-600">
          Rp 613.188
         </span>
        </label>
       </div>
       <div>
        <input class="hidden peer" id="candy7108" name="package" type="radio" value="7108"/>
        <label class="radio-label peer-checked:border-indigo-500 peer-checked:bg-indigo-100 flex flex-col items-center justify-center" for="candy7108" tabindex="0">
         <span class="text-lg font-semibold text-gray-900">
          7108 Candies
         </span>
         <span class="text-sm text-gray-600">
          Rp 1.288.671
         </span>
        </label>
       </div>
      </fieldset>
      <p class="mt-1 text-sm text-red-600 hidden" id="packageErrorCandy" role="alert">
       Harap pilih paket candy.
      </p>
     </div>
     <div class="hidden" id="passSection">
      <div class="flex justify-between items-center mb-2">
       <span class="block text-sm font-medium text-gray-700">
        Pass
       </span>
       <button aria-expanded="true" class="text-indigo-600 hover:text-indigo-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded text-sm" id="togglePassDetailsBtn" type="button">
        Sembunyikan
       </button>
      </div>
      <fieldset aria-describedby="packageErrorPass" aria-required="true" class="grid grid-cols-1 gap-4 max-h-96 overflow-y-auto">
       <div>
        <input class="hidden peer" id="passMobileRoyal" name="package" type="radio" value="Mobile Royal Pass"/>
        <label class="radio-label peer-checked:border-indigo-500 peer-checked:bg-indigo-100 flex items-center space-x-3" for="passMobileRoyal" tabindex="0">
         <div class="flex flex-col text-left">
          <span class="text-lg font-semibold text-gray-900">
           Mobile Royal Pass
          </span>
          <span class="text-sm text-gray-600">
           Rp 142.000
          </span>
         </div>
        </label>
       </div>
       <div>
        <input class="hidden peer" id="passElitePlus" name="package" type="radio" value="Elite Pass Plus"/>
        <label class="radio-label peer-checked:border-indigo-500 peer-checked:bg-indigo-100 flex items-center space-x-3" for="passElitePlus" tabindex="0">
         <div class="flex flex-col text-left">
          <span class="text-lg font-semibold text-gray-900">
           Elite Pass Plus
          </span>
          <span class="text-sm text-gray-600">
           Rp 364.000
          </span>
         </div>
        </label>
       </div>
      </fieldset>
      <p class="mt-1 text-sm text-red-600 hidden" id="packageErrorPass" role="alert">
       Harap pilih paket pass.
      </p>
     </div>
     <div>
      <span class="block text-sm font-medium text-gray-700 mb-2">
       Metode Pembayaran
      </span>
      <div class="border border-gray-300 rounded-md p-4 relative" id="paymentContainer">
       <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
         <span class="font-semibold text-gray-900" id="selectedPaymentLabel">
          Pilih Metode
         </span>
        </div>
        <button aria-controls="paymentOptions" aria-expanded="false" class="text-indigo-600 hover:text-indigo-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded flex items-center space-x-1" id="toggleDetailsBtn" type="button">
         <span id="toggleDetailsText">
          Detail
         </span>
         <i class="fas fa-chevron-down" id="toggleDetailsIcon">
         </i>
        </button>
       </div>
       <div aria-label="Opsi metode pembayaran" class="mt-4 border-t border-gray-200 pt-4 grid grid-cols-2 sm:grid-cols-3 gap-4 hidden" id="paymentOptions" role="list">
        <div role="listitem">
         <input class="hidden peer" id="payGopay" name="paymentMethod" type="radio" value="gopay"/>
         <label class="radio-label peer-checked:border-indigo-500 peer-checked:bg-indigo-100 cursor-pointer flex items-center space-x-2" for="payGopay" tabindex="0">
          <img alt="Logo GoPay berwarna biru dengan tulisan GoPay di bawahnya" class="payment-logo-square rounded" height="32" src="https://storage.googleapis.com/a1aa/image/ea6ab2a7-d049-4a3c-48d4-275f34d2ac4e.jpg" width="32"/>
          <span class="text-gray-900 font-semibold">
           GoPay
          </span>
         </label>
        </div>
        <div role="listitem">
         <input class="hidden peer" id="payQris" name="paymentMethod" type="radio" value="qris"/>
         <label class="radio-label peer-checked:border-indigo-500 peer-checked:bg-indigo-100 cursor-pointer flex items-center space-x-2" for="payQris" tabindex="0">
          <img alt="Logo QRIS hitam putih dengan pola QR code" class="payment-logo-rect rounded" height="24" src="https://storage.googleapis.com/a1aa/image/3720a347-d582-4866-2ffb-c7d21ae8dc32.jpg" width="48"/>
          <span class="text-gray-900 font-semibold">
           QRIS
          </span>
         </label>
        </div>
        <div role="listitem">
         <input class="hidden peer" id="payOvo" name="paymentMethod" type="radio" value="ovo"/>
         <label class="radio-label peer-checked:border-indigo-500 peer-checked:bg-indigo-100 cursor-pointer flex items-center space-x-2" for="payOvo" tabindex="0">
          <img alt="Logo OVO ungu dengan tulisan OVO" class="payment-logo-rect rounded" height="24" src="https://storage.googleapis.com/a1aa/image/4aabfc09-4e51-4ed1-aaeb-45c5b31a67f0.jpg" width="48"/>
          <span class="text-gray-900 font-semibold">
           OVO
          </span>
         </label>
        </div>
        <div role="listitem">
         <input class="hidden peer" id="payDana" name="paymentMethod" type="radio" value="dana"/>
         <label class="radio-label peer-checked:border-indigo-500 peer-checked:bg-indigo-100 cursor-pointer flex items-center space-x-2" for="payDana" tabindex="0">
          <img alt="Logo DANA biru dengan tulisan DANA" class="payment-logo-rect rounded" height="24" src="https://storage.googleapis.com/a1aa/image/1b8aa5ec-2da1-4b2c-b3cf-17c781c8542f.jpg" width="48"/>
          <span class="text-gray-900 font-semibold">
           DANA
          </span>
         </label>
        </div>
        <div role="listitem">
         <input class="hidden peer" id="paySpay" name="paymentMethod" type="radio" value="spay"/>
         <label class="radio-label peer-checked:border-indigo-500 peer-checked:bg-indigo-100 cursor-pointer flex items-center space-x-2" for="paySpay" tabindex="0">
          <img alt="Logo ShopeePay oranye dengan tulisan ShopeePay" class="payment-logo-rect rounded" height="24" src="https://storage.googleapis.com/a1aa/image/ed5992ab-82f7-4d71-44a5-a84c63825d67.jpg" width="48"/>
          <span class="text-gray-900 font-semibold">
           ShopeePay
          </span>
         </label>
        </div>
        <div role="listitem">
         <input class="hidden peer" id="payLinkaja" name="paymentMethod" type="radio" value="linkaja"/>
         <label class="radio-label peer-checked:border-indigo-500 peer-checked:bg-indigo-100 cursor-pointer flex items-center space-x-2" for="payLinkaja" tabindex="0">
          <img alt="Logo LinkAja merah dengan tulisan LinkAja" class="payment-logo-square rounded" height="32" src="https://storage.googleapis.com/a1aa/image/510130dd-5262-4ac5-5fc4-0f56eef1b999.jpg" width="32"/>
          <span class="text-gray-900 font-semibold">
           LinkAja
          </span>
         </label>
        </div>
       </div>
      </div>
      <p class="mt-1 text-sm text-yellow-600 hidden" id="paymentBlockedAttention" role="alert">
       Pilih jenis topup dan paket terlebih dahulu untuk memilih metode pembayaran.
      </p>
      <p class="mt-1 text-sm text-red-600 hidden" id="paymentMethodError" role="alert">
       Harap pilih metode pembayaran.
      </p>
     </div>
     <button class="w-full bg-indigo-600 hover:bg-indigo-700 focus:ring-indigo-500 focus:ring-2 focus:ring-offset-2 text-white font-semibold py-3 rounded-md transition-colors" type="submit">
      Lanjutkan Topup
     </button>
    </form>
    <div class="hidden mt-8 p-4 bg-green-50 border border-green-400 rounded text-green-700" id="confirmation" role="alert" tabindex="0">
    </div>
   </section>
  </main>
  <footer class="bg-white shadow-inner py-4 mt-auto fade-in">
   <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-gray-500 text-sm">
    Â© 2024 BOI XD Topup. Semua hak dilindungi.
   </div>
  </footer>
  <script>
   (() => {
    const form = document.getElementById("topupForm");
    const userIdInput = document.getElementById("userId");
    const topupTypeRadios = form.querySelectorAll('input[name="topupType"]');
    const candySection = document.getElementById("candySection");
    const passSection = document.getElementById("passSection");
    const packageRadios = form.querySelectorAll('input[name="package"]');
    const paymentMethodRadios = form.querySelectorAll('input[name="paymentMethod"]');
    const paymentOptions = document.getElementById("paymentOptions");
    const paymentContainer = document.getElementById("paymentContainer");
    const toggleDetailsBtn = document.getElementById("toggleDetailsBtn");
    const selectedPaymentLabel = document.getElementById("selectedPaymentLabel");
    const toggleDetailsText = document.getElementById("toggleDetailsText");
    const toggleDetailsIcon = document.getElementById("toggleDetailsIcon");
    const toggleTopupTypeBtn = document.getElementById("toggleTopupTypeBtn");
    const topupTypeOptions = document.getElementById("topupTypeOptions");
    const selectedTopupType = document.getElementById("selectedTopupType");

    const toggleCandyDetailsBtn = document.getElementById("toggleCandyDetailsBtn");
    const togglePassDetailsBtn = document.getElementById("togglePassDetailsBtn");

    const packageErrorCandy = document.getElementById("packageErrorCandy");
    const packageErrorPass = document.getElementById("packageErrorPass");
    const topupTypeError = document.getElementById("topupTypeError");
    const paymentMethodError = document.getElementById("paymentMethodError");
    const paymentBlockedAttention = document.getElementById("paymentBlockedAttention");
    const confirmation = document.getElementById("confirmation");

    // Terpilih (Rp) untuk paket
    const packageBasePrices = {
      "61": 11976,
      "186": 36727,
      "318": 61729,
      "686": 122857,
      "1378": 246014,
      "2118": 366875,
      "3548": 613188,
      "7108": 1288671,
      "Mobile Royal Pass": 142000,
      "Elite Pass Plus": 364000,
    };

    // Harga Jual (Rp) untuk paket
    const packageSellPrices = {
      "61": 12400,
      "186": 37900,
      "318": 63600,
      "686": 126600,
      "1378": 253400,
      "2118": 377900,
      "3548": 631600,
      "7108": 1327400,
      "Mobile Royal Pass": 149100,
      "Elite Pass Plus": 382200,
    };

    const largePackages = [
      "1378",
      "2118",
      "3548",
      "7108",
      "Elite Pass Plus",
    ];
    const paymentPriceAdjustments = {
      gopay: (base, pkg) => {
        if (largePackages.includes(pkg)) {
          return Math.round(base * 1.03);
        }
        return Math.round(base * 1.02);
      },
      qris: (base) => base + 1,
      ovo: (base, pkg) => {
        if (largePackages.includes(pkg)) {
          return Math.round(base * 1.03);
        }
        return Math.round(base * 1.02);
      },
      dana: (base, pkg) => {
        if (largePackages.includes(pkg)) {
          return Math.round(base * 1.03);
        }
        return Math.round(base * 1.02);
      },
      spay: (base, pkg) => {
        if (largePackages.includes(pkg)) {
          return Math.round(base * 1.03);
        }
        return Math.round(base * 1.02);
      },
      linkaja: (base, pkg) => {
        if (largePackages.includes(pkg)) {
          return Math.round(base * 1.03);
        }
        return Math.round(base * 1.02);
      },
    };

    function formatRupiah(number) {
      return "Rp " + number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }

    function updatePaymentPrices() {
      const selectedPackage = Array.from(packageRadios).find((r) => r.checked);
      if (!selectedPackage) {
        ["Gopay", "Qris", "Ovo", "Dana", "Spay", "Linkaja"].forEach((method) => {
          const el = document.getElementById("price" + method);
          if (el) el.textContent = "Harga Jual";
        });
        return;
      }

      const nominal = selectedPackage.value;
      const basePrice = packageSellPrices[nominal];
      if (!basePrice) return;

      paymentMethodRadios.forEach((radio) => {
        const priceSpan = document.getElementById(
          "price" + radio.value.charAt(0).toUpperCase() + radio.value.slice(1)
        );
        if (!priceSpan) return;
        const adjustedPrice = paymentPriceAdjustments[radio.value](basePrice, nominal);
        if (radio.value === "qris") {
          priceSpan.textContent = formatRupiah(adjustedPrice) + " + Rp 1";
        } else {
          priceSpan.textContent = formatRupiah(adjustedPrice);
        }
      });
    }

    function validateTopupType() {
      let selected = false;
      topupTypeRadios.forEach((radio) => {
        if (radio.checked) selected = true;
      });
      if (!selected) {
        topupTypeError.classList.remove("hidden");
      } else {
        topupTypeError.classList.add("hidden");
      }
      return selected;
    }

    function validatePackage() {
      let selected = false;
      packageRadios.forEach((radio) => {
        if (radio.checked) selected = true;
      });
      if (!selected) {
        if (!candySection.classList.contains("hidden")) {
          packageErrorCandy.classList.remove("hidden");
          packageErrorPass.classList.add("hidden");
        } else if (!passSection.classList.contains("hidden")) {
          packageErrorCandy.classList.add("hidden");
          packageErrorPass.classList.remove("hidden");
        }
      } else {
        packageErrorCandy.classList.add("hidden");
        packageErrorPass.classList.add("hidden");
      }
      return selected;
    }

    function validatePaymentMethod() {
      let selected = false;
      paymentMethodRadios.forEach((radio) => {
        if (radio.checked) selected = true;
      });
      if (!selected) {
        paymentMethodError.classList.remove("hidden");
      } else {
        paymentMethodError.classList.add("hidden");
      }
      return selected;
    }

    function updatePaymentAvailability() {
      const topupSelected = validateTopupType();
      const packageSelected = validatePackage();
      if (topupSelected && packageSelected) {
        paymentContainer.classList.remove("payment-disabled");
        paymentBlockedAttention.classList.add("hidden");
        paymentMethodRadios.forEach((radio) => {
          radio.disabled = false;
        });
      } else {
        paymentContainer.classList.add("payment-disabled");
        paymentBlockedAttention.classList.remove("hidden");
        paymentMethodError.classList.add("hidden");
        paymentMethodRadios.forEach((radio) => {
          radio.checked = false;
          radio.disabled = true;
        });
        selectedPaymentLabel.textContent = "Pilih Metode";
        paymentOptions.classList.add("hidden");
        toggleDetailsBtn.setAttribute("aria-expanded", "false");
        toggleDetailsText.textContent = "Detail";
        toggleDetailsIcon.classList.remove("fa-chevron-up");
        toggleDetailsIcon.classList.add("fa-chevron-down");
        updatePaymentPrices();
      }
    }

    function addPressAnimation(button) {
      button.addEventListener("click", () => {
        button.classList.add("btn-press");
        setTimeout(() => {
          button.classList.remove("btn-press");
        }, 200);
      });
    }

    [toggleTopupTypeBtn, toggleDetailsBtn, toggleCandyDetailsBtn, togglePassDetailsBtn].forEach(
      (btn) => {
        if (btn) addPressAnimation(btn);
      }
    );

    toggleTopupTypeBtn.addEventListener("click", () => {
      const expanded = toggleTopupTypeBtn.getAttribute("aria-expanded") === "true";
      if (expanded) {
        topupTypeOptions.classList.add("hidden");
        toggleTopupTypeBtn.setAttribute("aria-expanded", "false");
        toggleTopupTypeText.textContent = "Detail";
        toggleTopupTypeIcon.classList.remove("fa-chevron-up");
        toggleTopupTypeIcon.classList.add("fa-chevron-down");
      } else {
        topupTypeOptions.classList.remove("hidden");
        toggleTopupTypeBtn.setAttribute("aria-expanded", "true");
        toggleTopupTypeText.textContent = "Sembunyikan";
        toggleTopupTypeIcon.classList.remove("fa-chevron-down");
        toggleTopupTypeIcon.classList.add("fa-chevron-up");
      }
    });

    toggleDetailsBtn.addEventListener("click", () => {
      const expanded = toggleDetailsBtn.getAttribute("aria-expanded") === "true";
      if (expanded) {
        paymentOptions.classList.add("hidden");
        toggleDetailsBtn.setAttribute("aria-expanded", "false");
        toggleDetailsText.textContent = "Detail";
        toggleDetailsIcon.classList.remove("fa-chevron-up");
        toggleDetailsIcon.classList.add("fa-chevron-down");
      } else {
        paymentOptions.classList.remove("hidden");
        toggleDetailsBtn.setAttribute("aria-expanded", "true");
        toggleDetailsText.textContent = "Sembunyikan";
        toggleDetailsIcon.classList.remove("fa-chevron-down");
        toggleDetailsIcon.classList.add("fa-chevron-up");
      }
    });

    toggleCandyDetailsBtn.addEventListener("click", () => {
      const fieldset = candySection.querySelector("fieldset");
      const expanded = toggleCandyDetailsBtn.getAttribute("aria-expanded") === "true";
      if (expanded) {
        fieldset.classList.add("hidden");
        toggleCandyDetailsBtn.setAttribute("aria-expanded", "false");
        toggleCandyDetailsBtn.textContent = "Munculkan detail";
      } else {
        fieldset.classList.remove("hidden");
        toggleCandyDetailsBtn.setAttribute("aria-expanded", "true");
        toggleCandyDetailsBtn.textContent = "Sembunyikan";
      }
    });

    togglePassDetailsBtn.addEventListener("click", () => {
      const fieldset = passSection.querySelector("fieldset");
      const expanded = togglePassDetailsBtn.getAttribute("aria-expanded") === "true";
      if (expanded) {
        fieldset.classList.add("hidden");
        togglePassDetailsBtn.setAttribute("aria-expanded", "false");
        togglePassDetailsBtn.textContent = "Munculkan detail";
      } else {
        fieldset.classList.remove("hidden");
        togglePassDetailsBtn.setAttribute("aria-expanded", "true");
        togglePassDetailsBtn.textContent = "Sembunyikan";
      }
    });

    topupTypeRadios.forEach((radio) => {
      radio.addEventListener("change", () => {
        if (radio.value === "candy") {
          selectedTopupType.textContent = "Candy";
          candySection.classList.remove("hidden");
          passSection.classList.add("hidden");
        } else if (radio.value === "pass") {
          selectedTopupType.textContent = "Pass";
          candySection.classList.add("hidden");
          passSection.classList.remove("hidden");
        }
        packageRadios.forEach((pkg) => (pkg.checked = false));
        paymentMethodRadios.forEach((pm) => (pm.checked = false));
        selectedPaymentLabel.textContent = "Pilih Metode";
        paymentOptions.classList.add("hidden");
        updatePaymentAvailability();
        updatePaymentPrices();
      });
    });

    packageRadios.forEach((radio) => {
      radio.addEventListener("change", () => {
        paymentMethodRadios.forEach((pmRadio) => {
          pmRadio.checked = false;
        });
        selectedPaymentLabel.textContent = "Pilih Metode";
        paymentOptions.classList.add("hidden");
        updatePaymentAvailability();
        updatePaymentPrices();
      });
    });

    paymentMethodRadios.forEach((radio) => {
      radio.addEventListener("change", () => {
        const selectedLabel = radio.nextElementSibling.querySelector("span.font-semibold");
        if (selectedLabel) {
          selectedPaymentLabel.textContent = selectedLabel.textContent;
        }
      });
    });

    updatePaymentAvailability();

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const missingFields = [];
      if (!validateTopupType()) missingFields.push("Jenis Topup");
      if (!validatePackage()) missingFields.push("Paket");
      if (!validatePaymentMethod()) missingFields.push("Metode Pembayaran");

      if (missingFields.length > 0) {
        alert(`Harap isi ${missingFields.join(", ")}`);
        return;
      }

      const selectedPackage = Array.from(packageRadios).find((r) => r.checked);
      const packageLabel = selectedPackage.nextElementSibling.querySelector("span.text-lg, span.font-semibold").textContent;
      const basePrice = packageBasePrices[selectedPackage.value];
      const selectedPayment = Array.from(paymentMethodRadios).find((r) => r.checked);
      const paymentLabel = selectedPayment.nextElementSibling.querySelector("span.font-semibold").textContent;
      const adjustedPrice = paymentPriceAdjustments[selectedPayment.value](packageSellPrices[selectedPackage.value], selectedPackage.value);

      const userId = userIdInput.value.trim() || "(tidak diisi)";

      const phoneNumber = "6283132420423";

      const message =
        `Halo, saya ingin melakukan topup Sausage Man dengan detail berikut:%0A` +
        `ID Pengguna: ${userId}%0A` +
        `Jenis Topup: ${selectedTopupType.textContent} (Terpilih: ${formatRupiah(basePrice)})%0A` +
        `Nominal: ${packageLabel}%0A` +
        `Metode Pembayaran: ${paymentLabel}%0A` +
        `Harga: ${formatRupiah(adjustedPrice)}`;

      const whatsappUrl = `https://wa.me/${phoneNumber}?text=${message}`;

      window.open(whatsappUrl, "_blank");
    });
  })();
  </script>
 </body>
</html>